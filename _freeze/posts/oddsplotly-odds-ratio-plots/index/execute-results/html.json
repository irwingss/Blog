{
  "hash": "12a216815bd152de2b9e24b08adef133",
  "result": {
    "markdown": "---\ntitle: \"Gráficos de Odds Ratio con OddsPlotty\"\nauthor: \"Irwing S. Saldaña\"\ndate: \"2021-07-21\"\ncategories: [ggplot2, dataviz, R, Estadística]\nimage: \"img/portada.png\"\n---\n\n\nEn este tutorial revisaremos el uso de la nueva librería OddsPlotty para la generación de gráficos de Odds Ratio.\n\n<br>\n\n## **Video explicativo**\n\n\n```{=html}\n<div style=\"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\">\n  <iframe src=\"https://www.youtube.com/embed/0KIBd4S6rt8?autoplay=0\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;\" allowfullscreen title=\"Video explicativo\"></iframe>\n</div>\n```\n\n<br>\n\n## **Librarías de Trabajo** \n\nEl siguiente código sirve para instalar las librerías a usar:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"OddsPlotty\")\ninstall.packages(\"tidyverse\")\ninstall.packages(\"mlbench\")\n```\n:::\n\n\nAhora, activa las librerías:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(OddsPlotty)\nlibrary(mlbench) # para cargar la base de datos\n```\n:::\n\n\n<br>\n\n## **Transformación inicial de la base de datos**\n\nEste paso no es necesario siempre. El objetivo es eliminar filas sin datos (incompletas), eliminar columnas que no vayan a ser usadas en el modelo GLM, y, para efectos de este ejercicio simple, convertir en numéricas las columnas factor.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cargamos la base de datos BreastCancer\ndata(\"BreastCancer\")\n\n# Vista previa\nhead(BreastCancer)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       Id Cl.thickness Cell.size Cell.shape Marg.adhesion Epith.c.size\n1 1000025            5         1          1             1            2\n2 1002945            5         4          4             5            7\n3 1015425            3         1          1             1            2\n4 1016277            6         8          8             1            3\n5 1017023            4         1          1             3            2\n6 1017122            8        10         10             8            7\n  Bare.nuclei Bl.cromatin Normal.nucleoli Mitoses     Class\n1           1           3               1       1    benign\n2          10           3               2       1    benign\n3           2           3               1       1    benign\n4           4           3               7       1    benign\n5           1           3               1       1    benign\n6          10           9               7       1 malignant\n```\n:::\n\n```{.r .cell-code}\n# Transformación\nBreastCancer <- BreastCancer %>% \n  select(-1) %>%  # eliminar columnas que se vayan a usar\n  mutate_if(is.factor, as.numeric) %>% # convertir columnas factores a numéricas\n  mutate(Class = factor(Class)) %>% #convertir a factor la variable respuesta\n  filter(complete.cases(.)) # eliminar filas incompletas \n```\n:::\n\n\n<br>\n\n## **Modelo lineal**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Crear el modelo generalizado lineal (GLM): regresión logística\nmod1 <- glm(Class ~ ., data = BreastCancer, family = binomial(link = \"logit\"))\n\n# Resumen estadístico del modelo\nsummary(mod1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = Class ~ ., family = binomial(link = \"logit\"), data = BreastCancer)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-3.4855  -0.1152  -0.0619   0.0222   2.4702  \n\nCoefficients:\n                  Estimate Std. Error z value Pr(>|z|)    \n(Intercept)     -10.110096   1.173774  -8.613  < 2e-16 ***\nCl.thickness      0.535256   0.141938   3.771 0.000163 ***\nCell.size        -0.005943   0.209158  -0.028 0.977332    \nCell.shape        0.322136   0.230644   1.397 0.162510    \nMarg.adhesion     0.330694   0.123462   2.679 0.007395 ** \nEpith.c.size      0.096797   0.156568   0.618 0.536415    \nBare.nuclei       0.383015   0.093865   4.080 4.49e-05 ***\nBl.cromatin       0.447401   0.171392   2.610 0.009044 ** \nNormal.nucleoli   0.213074   0.112894   1.887 0.059109 .  \nMitoses           0.538551   0.325615   1.654 0.098138 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 884.35  on 682  degrees of freedom\nResidual deviance: 102.90  on 673  degrees of freedom\nAIC: 122.9\n\nNumber of Fisher Scoring iterations: 8\n```\n:::\n:::\n\n\n<br>\n\n## **Gráfico con OddsPlotty**\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Gráfico inicial\nOR <- odds_plot(mod1, \n                title = \"Odds Ratios\",\n                subtitle = \"Factores Asociados al Cáncer de Pulmón\",\n                point_col = \"#5f00db\", \n                error_bar_colour = \"#5f00db\",\n                point_size = 1, \n                error_bar_width = 0.2,\n                h_line_color = \"#5f00db\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWaiting for profiling to be done...\n```\n:::\n\n```{.r .cell-code}\nOR$odds_plot\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=90%}\n:::\n\n```{.r .cell-code}\n# Adicionar un tema, eliminar leyenda y etiqueta del eje Y\nORplot <- OR$odds_plot+\n  theme_test()+\n  theme(legend.position = \"none\")+\n  labs(x=\"\")\nORplot\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-2.png){fig-align='center' width=90%}\n:::\n\n```{.r .cell-code}\n# Adicionar valores de Odds Ratio \nORplot +\n  geom_text(label = round(OR$odds_data$OR, digits = 2), size=3, \n            hjust = 1.5, vjust = -0.35, color=\"#5f00db\")+\n  # scale_x_discrete() te ayudará a modificar las etiquetas del eje Y.\n  # Por ejemplo, modificar Mitoses por Mitosis, o Cl.thickness por \n  # Grosor de Cl:\n  scale_x_discrete(expand=c(0.15,0.15),\n                   label = c(\"Mitoses\"=\"Mitosis\",\n                             \"Cl.thickness\"=\"Grosor de Cl\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-3.png){fig-align='center' width=90%}\n:::\n:::\n\n\n<br>\n\n## **Inspeccionar la información de Odds Ratios**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nOR$odds_data %>% as.data.frame()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         OR     lower    upper            vars\n1 1.7078851 1.3160488 2.311339    Cl.thickness\n2 0.9940746 0.6738898 1.550114       Cell.size\n3 1.3800729 0.8617778 2.155328      Cell.shape\n4 1.3919332 1.0975034 1.798580   Marg.adhesion\n5 1.1016369 0.8052066 1.499293    Epith.c.size\n6 1.4666999 1.2298023 1.783756     Bare.nuclei\n7 1.5642407 1.1313483 2.225679     Bl.cromatin\n8 1.2374760 0.9981626 1.561486 Normal.nucleoli\n9 1.7135219 0.9926455 3.025957         Mitoses\n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}